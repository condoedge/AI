# Configuration Reference

Complete reference for all AI system configuration options.

---

## Configuration Files

- **`config/ai.php`** – Main AI system configuration
- **`config/entities.php`** – Entity configurations (generated by `php artisan ai:discover`)
- **`.env`** – Environment-specific settings

---

## Quick Reference

**Most Important Settings:**

```env
# Project Context
APP_NAME="My E-Commerce Platform"
AI_PROJECT_DESCRIPTION="E-commerce platform with customer, order, and product management"
AI_PROJECT_DOMAIN=e-commerce

# Auto-Discovery (DISABLED by default - use command instead)
AI_AUTO_DISCOVERY_RUNTIME=false

# Auto-Sync (ENABLED by default)
AI_AUTO_SYNC_ENABLED=true
AI_AUTO_SYNC_QUEUE=false

# LLM Provider
AI_LLM_PROVIDER=openai
OPENAI_API_KEY=sk-your-key-here

# Databases
NEO4J_URI=bolt://localhost:7687
QDRANT_HOST=localhost
```

---

## Project Metadata Configuration

High-level information about your project that helps the LLM understand your business domain:

```env
# Application name (uses APP_NAME by default)
APP_NAME="My CRM Platform"

# Project description for LLM context
AI_PROJECT_DESCRIPTION="Customer relationship management system with sales pipeline tracking"

# Domain type (e.g., e-commerce, crm, healthcare, finance)
AI_PROJECT_DOMAIN=crm
```

**Configure in `config/ai.php`:**

```php
'project' => [
    'name' => env('APP_NAME', 'Laravel Application'),
    'description' => env('AI_PROJECT_DESCRIPTION', 'A Laravel application with AI capabilities.'),
    'domain' => env('AI_PROJECT_DOMAIN', 'general'),
    'business_rules' => [
        'Active customers have status = "active"',
        'Premium tier includes gold and platinum customers',
        'Orders are linked to customers via customer_id foreign key',
    ],
],
```

**Why this matters:**

The LLM receives this context when generating queries and responses, enabling:
- Domain-specific query generation (e.g., "premium customers" → correct tier filter)
- Business-aware response explanations
- Consistent terminology across all AI interactions
- Better understanding of implicit business logic

**Example domains:**
- `e-commerce` - Products, orders, customers, inventory
- `crm` - Leads, contacts, deals, sales pipeline
- `healthcare` - Patients, appointments, treatments, providers
- `finance` - Accounts, transactions, invoices, payments
- `general` - Default for generic applications

---

## Environment Variables

### Neo4j Configuration

```env
NEO4J_URI=bolt://localhost:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=your-secure-password
NEO4J_DATABASE=neo4j
NEO4J_ENABLED=true
```

| Variable | Type | Default | Description |
| --- | --- | --- | --- |
| `NEO4J_URI` | string | bolt://localhost:7687 | Neo4j connection URI |
| `NEO4J_USERNAME` | string | neo4j | Database username |
| `NEO4J_PASSWORD` | string | — | Database password |
| `NEO4J_DATABASE` | string | neo4j | Database name |
| `NEO4J_ENABLED` | bool | true | Enable/disable Neo4j |

---

### Qdrant Configuration

```env
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_API_KEY=
QDRANT_TIMEOUT=30
QDRANT_ENABLED=true
```

| Variable | Type | Default | Description |
| --- | --- | --- | --- |
| `QDRANT_HOST` | string | localhost | Qdrant hostname |
| `QDRANT_PORT` | int | 6333 | Qdrant port |
| `QDRANT_API_KEY` | string | null | API key (cloud only) |
| `QDRANT_TIMEOUT` | int | 30 | Request timeout (seconds) |
| `QDRANT_ENABLED` | bool | true | Enable/disable Qdrant |

---

### LLM Provider Configuration

```env
AI_LLM_PROVIDER=openai

# OpenAI
OPENAI_API_KEY=sk-your-key-here
OPENAI_MODEL=gpt-4o
OPENAI_TEMPERATURE=0.3
OPENAI_MAX_TOKENS=2000

# Anthropic
ANTHROPIC_API_KEY=sk-ant-your-key-here
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
ANTHROPIC_TEMPERATURE=0.3
ANTHROPIC_MAX_TOKENS=4000
```

| Variable | Type | Default | Description |
| --- | --- | --- | --- |
| `AI_LLM_PROVIDER` | string | openai | `openai` or `anthropic` |
| `OPENAI_API_KEY` | string | — | OpenAI API key |
| `OPENAI_MODEL` | string | gpt-4o | Chat model name |
| `OPENAI_TEMPERATURE` | float | 0.3 | Creativity dial |
| `OPENAI_MAX_TOKENS` | int | 2000 | Max response length |
| `ANTHROPIC_API_KEY` | string | — | Anthropic API key |
| `ANTHROPIC_MODEL` | string | claude-3-5-sonnet-20241022 | Chat model name |
| `ANTHROPIC_TEMPERATURE` | float | 0.3 | Creativity dial |
| `ANTHROPIC_MAX_TOKENS` | int | 2000 | Max response length |

---

### Embedding Provider Configuration

```env
AI_EMBEDDING_PROVIDER=openai
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
```

| Variable | Type | Default | Description |
| --- | --- | --- | --- |
| `AI_EMBEDDING_PROVIDER` | string | openai | `openai` or `anthropic` |
| `OPENAI_EMBEDDING_MODEL` | string | text-embedding-3-small | Embedding model (1536 dims) |

**Important:** Vector dimensions are configured in `config/ai.php`:

```php
'embedding' => [
    'openai' => [
        'dimensions' => 1536, // text-embedding-3-small
    ],
],
```

Qdrant collections automatically use these dimensions when created.

---

### Auto-Discovery Configuration

```env
# Enable ai:discover command (RECOMMENDED)
AI_AUTO_DISCOVERY_ENABLED=true

# Enable runtime auto-discovery (SLOW - only for dev/testing)
AI_AUTO_DISCOVERY_RUNTIME=false

# Cache discovered configurations
AI_AUTO_DISCOVERY_CACHE=true
AI_AUTO_DISCOVERY_CACHE_TTL=3600
```

| Variable | Type | Default | Description |
| --- | --- | --- | --- |
| `AI_AUTO_DISCOVERY_ENABLED` | bool | true | Enable `php artisan ai:discover` command |
| `AI_AUTO_DISCOVERY_RUNTIME` | bool | **false** | Enable runtime discovery (SLOW!) |
| `AI_AUTO_DISCOVERY_CACHE` | bool | true | Cache discovered configs |
| `AI_AUTO_DISCOVERY_CACHE_TTL` | int | 3600 | Cache TTL in seconds |

**⚠️ Important:** Runtime auto-discovery is **DISABLED by default** for performance.

**Recommended workflow:**
1. Run `php artisan ai:discover` to generate `config/entities.php`
2. Keep `AI_AUTO_DISCOVERY_RUNTIME=false` in production
3. Only enable runtime mode for development/testing

See: [Configuration Priority](#configuration-priority)

---

### Auto-Sync Configuration

```env
# Enable auto-sync globally
AI_AUTO_SYNC_ENABLED=true

# Queue sync operations for async processing
AI_AUTO_SYNC_QUEUE=false
AI_AUTO_SYNC_QUEUE_CONNECTION=redis
AI_AUTO_SYNC_QUEUE_NAME=default

# Operations to sync
AI_AUTO_SYNC_CREATE=true
AI_AUTO_SYNC_UPDATE=true
AI_AUTO_SYNC_DELETE=true

# Error handling
AI_AUTO_SYNC_FAIL_SILENTLY=true
AI_AUTO_SYNC_LOG_ERRORS=true
```

| Variable | Type | Default | Description |
| --- | --- | --- | --- |
| `AI_AUTO_SYNC_ENABLED` | bool | true | Enable auto-sync on model events |
| `AI_AUTO_SYNC_QUEUE` | bool | false | Queue sync operations |
| `AI_AUTO_SYNC_QUEUE_CONNECTION` | string | null | Queue connection (redis, etc.) |
| `AI_AUTO_SYNC_QUEUE_NAME` | string | default | Queue name |
| `AI_AUTO_SYNC_CREATE` | bool | true | Sync on model creation |
| `AI_AUTO_SYNC_UPDATE` | bool | true | Sync on model update |
| `AI_AUTO_SYNC_DELETE` | bool | true | Remove on model deletion |
| `AI_AUTO_SYNC_FAIL_SILENTLY` | bool | true | Don't throw exceptions |
| `AI_AUTO_SYNC_LOG_ERRORS` | bool | true | Log sync errors |

**When auto-sync is enabled**, models implementing `Nodeable` and using `HasNodeableConfig` trait automatically sync to Neo4j + Qdrant on create/update/delete.

**Performance tip:** For high-throughput applications, set `AI_AUTO_SYNC_QUEUE=true` to process sync operations asynchronously.

---

### Query & RAG Settings

```env
AI_MAX_RESULTS=100
AI_QUERY_TIMEOUT=30
AI_CACHE_TTL=3600

AI_VECTOR_SEARCH_LIMIT=5
AI_SIMILARITY_THRESHOLD=0.7
AI_INCLUDE_SCHEMA=true
AI_INCLUDE_EXAMPLES=true
```

| Variable | Type | Default | Description |
| --- | --- | --- | --- |
| `AI_MAX_RESULTS` | int | 100 | Max query results |
| `AI_QUERY_TIMEOUT` | int | 30 | Query timeout (seconds) |
| `AI_CACHE_TTL` | int | 3600 | Cache duration (seconds) |
| `AI_VECTOR_SEARCH_LIMIT` | int | 5 | Similar queries retrieved |
| `AI_SIMILARITY_THRESHOLD` | float | 0.7 | Min similarity score |
| `AI_INCLUDE_SCHEMA` | bool | true | Include graph schema in RAG |
| `AI_INCLUDE_EXAMPLES` | bool | true | Include example entities |

---

### Documentation Settings

```env
AI_DOCS_ENABLED=true
AI_DOCS_PREFIX=ai-docs
```

| Variable | Type | Default | Description |
| --- | --- | --- | --- |
| `AI_DOCS_ENABLED` | bool | true | Enable documentation routes |
| `AI_DOCS_PREFIX` | string | ai-docs | URL prefix for docs |

---

---

## Configuration Priority

Entity configurations are resolved in this order (highest to lowest):

### 1. `nodeableConfig()` Method (Highest Priority) ⭐⭐⭐

Define configuration directly in your model using the `NodeableConfig` builder:

```php
class Customer extends Model implements Nodeable
{
    use HasNodeableConfig;

    public function nodeableConfig(): NodeableConfig
    {
        return NodeableConfig::for(static::class)
            ->label('Customer')
            ->properties('id', 'name', 'email')
            ->collection('customers')
            ->embedFields('name', 'company');
    }
}
```

**Advantages:**
- ✅ Configuration lives with the model
- ✅ Type-safe with IDE autocomplete
- ✅ Supports dynamic logic and conditionals
- ✅ **Overrides all other configurations**

**Use when:** You need dynamic config, type safety, or want config near the model.

See: [Advanced Usage - NodeableConfig API](/docs/{{version}}/usage/advanced-usage#complete-nodeable-config-api)

### 2. `config/entities.php` (Middle Priority) ⭐⭐

Generated by `php artisan ai:discover` command:

```php
// config/entities.php
return [
    'App\\Models\\Customer' => [
        'graph' => [
            'label' => 'Customer',
            'properties' => ['id', 'name', 'email', 'status'],
            'relationships' => [
                [
                    'type' => 'PLACED_ORDER',
                    'target_label' => 'Order',
                    'foreign_key' => 'customer_id',
                ],
            ],
        ],
        'vector' => [
            'collection' => 'customers',
            'embed_fields' => ['name', 'email', 'company'],
            'metadata' => ['id', 'name', 'status'],
        ],
    ],
];
```

**Advantages:**
- ✅ Centralized configuration
- ✅ Auto-generated from your models
- ✅ Fast (no runtime discovery)
- ✅ Easy to review and customize

**Use when:** Standard configuration for most entities.

**Generate with:**
```bash
php artisan ai:discover
```

### 3. Runtime Auto-Discovery (Lowest Priority) ⭐

**⚠️ DISABLED by default** for performance reasons.

When enabled with `AI_AUTO_DISCOVERY_RUNTIME=true`, the system analyzes models at runtime to generate configurations automatically.

**Disadvantages:**
- ❌ SLOW (analyzes models on every request)
- ❌ Only suitable for development/testing
- ❌ Lowest priority (overridden by methods above)

**Only enable for:**
- Development/testing
- Prototyping new entities
- Learning the system

**Production:** Always use `config/entities.php` or `nodeableConfig()` method.

---

## Entity Configuration (`config/entities.php`)

Generated by `php artisan ai:discover`:

```bash
php artisan ai:discover
```

**Example configuration:**

```php
return [
    'App\\Models\\Customer' => [
        'graph' => [
            'label' => 'Customer',
            'properties' => ['id', 'name', 'email', 'status'],
            'relationships' => [
                [
                    'type' => 'PLACED_ORDER',
                    'target_label' => 'Order',
                    'foreign_key' => 'customer_id',
                ],
            ],
        ],
        'vector' => [
            'collection' => 'customers',
            'embed_fields' => ['name', 'description', 'company'],
            'metadata' => ['id', 'email', 'status', 'created_at'],
        ],
        'metadata' => [
            'aliases' => ['client', 'buyer', 'account'],
            'description' => 'Customer entity with orders and billing',
        ],
    ],
];
```

### Graph Configuration

```php
'graph' => [
    'label' => 'NodeLabel',                    // Neo4j node label
    'properties' => ['id', 'name', 'email'],  // Properties to store
    'relationships' => [
        [
            'type' => 'RELATIONSHIP_TYPE',     // Relationship type (UPPER_SNAKE_CASE)
            'target_label' => 'TargetNode',    // Target node label
            'foreign_key' => 'target_id',      // Foreign key column
        ],
    ],
];
```

### Vector Configuration

```php
'vector' => [
    'collection' => 'collection_name',              // Qdrant collection name
    'embed_fields' => ['name', 'description'],      // Fields to embed
    'metadata' => ['id', 'status', 'created_at'],  // Metadata for filtering
];
```

**Note:** Qdrant collections are **automatically created** on first use with proper dimensions from `config/ai.php`.

### Metadata Configuration

```php
'metadata' => [
    'aliases' => ['customer', 'client', 'buyer'],           // Alternative names
    'description' => 'Customer entity with order history',  // Human description
    'common_properties' => [
        'status' => 'Customer status: active, inactive, suspended',
        'tier' => 'Membership tier: bronze, silver, gold',
    ],
];
```

---

## Publishing Commands

Publish configuration files to customize them:

```bash
# Publish main configuration
php artisan vendor:publish --tag=ai-config

# Publish entities configuration (or use ai:discover command)
php artisan vendor:publish --tag=ai-entities
```

After publishing, customize files in your `config/` directory.

---

## Artisan Commands

### Discovery Commands

```bash
# Generate entity configurations
php artisan ai:discover

# Preview without writing
php artisan ai:discover --dry-run

# Discover specific model
php artisan ai:discover --model="App\Models\Customer"
```

See: [Quick Start - Step 2](/docs/{{version}}/usage/quick-start#step-2-discover-and-generate-config-1-minute)

### Ingestion Commands

```bash
# Bulk ingest existing data
php artisan ai:ingest

# Ingest specific model
php artisan ai:ingest --model="App\Models\Customer"

# Custom batch size
php artisan ai:ingest --chunk=500

# Preview without ingesting
php artisan ai:ingest --dry-run
```

See: [Data Ingestion - Bulk Command](/docs/{{version}}/usage/data-ingestion#bulk-ingestion-command)

---

## Programmatic Access

Access configuration programmatically:

```php
// LLM settings
$provider = config('ai.llm.default');           // 'openai'
$model = config('ai.llm.openai.model');        // 'gpt-4o'

// Database settings
$neo4jUri = config('ai.graph.neo4j.uri');      // 'bolt://localhost:7687'
$qdrantHost = config('ai.vector.qdrant.host'); // 'localhost'

// Auto-sync settings
$autoSyncEnabled = config('ai.auto_sync.enabled');  // true
$autoSyncQueue = config('ai.auto_sync.queue');      // false

// Auto-discovery settings
$runtimeEnabled = config('ai.auto_discovery.runtime_enabled'); // false

// Entity configuration
$entities = config('entities');  // All entity configs
```

**Override at runtime:**

```php
// Temporarily disable auto-sync
config(['ai.auto_sync.enabled' => false]);

Customer::create(['name' => 'Test']); // Not synced

// Re-enable
config(['ai.auto_sync.enabled' => true]);
```

---

## Best Practices

### Production Setup

**✅ DO:**
- Keep secrets in `.env`, never commit to Git
- Run `php artisan ai:discover` to generate `config/entities.php`
- Keep `AI_AUTO_DISCOVERY_RUNTIME=false` in production (use generated config)
- Use `AI_AUTO_SYNC_QUEUE=true` for high-throughput applications
- Set appropriate `AI_SIMILARITY_THRESHOLD` (0.65–0.8 works well)
- Monitor slow queries with `AI_EXEC_LOG_SLOW=true`

**❌ DON'T:**
- Don't enable runtime auto-discovery in production (SLOW!)
- Don't manually call `AI::ingest()` for new entities (use auto-sync)
- Don't commit API keys or passwords to version control
- Don't skip `php artisan ai:discover` before deploying

### Development Workflow

```bash
# 1. Create/modify your Eloquent models
# 2. Generate configuration
php artisan ai:discover

# 3. Review generated config/entities.php
# 4. Customize if needed

# 5. Bulk ingest existing data (one-time)
php artisan ai:ingest

# 6. New entities auto-sync automatically!
```

### Configuration Approaches

**Use `config/entities.php` when:**
- Standard configurations for most entities
- Centralized configuration preferred
- Auto-generated config is sufficient

**Use `nodeableConfig()` method when:**
- Need dynamic configuration (environment-based, feature flags)
- Want type safety and IDE autocomplete
- Configuration should live with the model
- Complex or conditional configurations

**Use runtime auto-discovery when:**
- Development/testing only
- Prototyping new entities
- Learning the system
- NEVER in production!

### Performance Optimization

**High-throughput applications:**

```env
AI_AUTO_SYNC_QUEUE=true
AI_AUTO_SYNC_QUEUE_CONNECTION=redis
```

**Disable auto-sync during seeding:**

```php
// database/seeders/DatabaseSeeder.php
config(['ai.auto_sync.enabled' => false]);

Customer::factory()->count(10000)->create();

// Bulk ingest after seeding
Artisan::call('ai:ingest');
```

---

## Related Documentation

- **[Quick Start](/docs/{{version}}/usage/quick-start)** - Get started in 5 minutes
- **[Data Ingestion](/docs/{{version}}/usage/data-ingestion)** - Auto-sync and bulk ingestion
- **[Advanced Usage](/docs/{{version}}/usage/advanced-usage)** - NodeableConfig API and direct services
- **[Installation Guide](/docs/{{version}}/foundations/installing)** - Install and verify infrastructure
- **[Troubleshooting](/docs/{{version}}/foundations/troubleshooting)** - Common issues and solutions
